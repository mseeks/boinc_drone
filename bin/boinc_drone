#!/usr/bin/env ruby

lib = File.expand_path(File.dirname(__FILE__) + '/../lib')
$LOAD_PATH.unshift(lib) if File.directory?(lib) && !$LOAD_PATH.include?(lib)

require "boinc_drone"
require "optparse"

params = {}
opt = OptionParser.new do |opt|
  opt.on('-k', '--key KEY', 'API key') do |key|
    params[:api_key] = key
  end

  opt.on('-u', '--url URL', 'Webhook URL') do |url|
    things[:webhook_url] = url
  end
  
  opt.on('-w', '--worker ID', 'Woker ID') do |id|
    things[:worker_id] = id
  end
end

opt.parse

loop do
  @report = BoincDrone::Report.new(params)
  @report.post
  sleep(300)
end
